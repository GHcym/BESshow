# BESSOW 專案分析報告

**日期:** 2025年09月10日
**分析員:** Gemini AI

## 1. 專案總結

BESSOW 是一個基於 Django 建構的現代化電子商務網站，專為提供線上點燈服務而設計。專案採用了容器化技術 (Docker) 進行部署，並整合了會員系統、商品展示、購物車與訂單處理等核心功能。其技術選型現代，架構清晰，具備良好的開發基礎。

一個顯著的特色是系統深度整合了農曆計算功能，能夠根據使用者的國曆生日自動轉換並儲存農曆生日及時辰，這與點燈服務的宗教文化背景高度契合。

## 2. 技術堆疊分析

| 分類 | 技術/函式庫 | 版本 | 說明 |
| :--- | :--- | :--- | :--- |
| **後端框架** | Django | ~5.1 | 核心 Web 框架。 |
| **程式語言** | Python | >=3.12 | 專案使用的主要語言。 |
| **資料庫** | PostgreSQL | 16 | 關聯式資料庫，用於儲存所有應用資料。 |
| **部署** | Docker, Gunicorn | latest, ~23.0 | 使用 Docker 進行容器化，Gunicorn 作為 WSGI 伺服器。 |
| **套件管理** | uv | latest | 高效能的 Python 套件管理器。 |
| **身份驗證** | django-allauth | ~65.2 | 處理使用者註冊、登入、登出及社群帳號整合。 |
| **前端表單** | crispy-bootstrap5 | ~2024.10 | 整合 Django 表單與 Bootstrap 5 樣式。 |
| **靜態檔案** | whitenoise | ~6.7 | 高效能的 Django 靜態檔案服務函式庫。 |
| **特殊功能** | lunar_python | 1.4.4 | 用於國曆與農曆日期時間的轉換。 |
| **圖片處理** | Pillow | ~11.3 | 處理商品圖片上傳。 |

## 3. 功能模組分析

專案遵循 Django 的最佳實踐，將功能拆分為獨立的應用 (App)，各模組職責分明：

- **`accounts` (帳號系統):**
    - **核心模型:** `CustomUser` 擴充了標準使用者模型，增加了 UUID、手機、性別、生日 (國曆/農曆)、地址等欄位，以滿足業務需求。
    - **核心邏輯:** 在使用者儲存時，會自動將國曆生日轉換為農曆資訊。提供了使用者個人資料的 CRUD (建立、讀取、更新、刪除) 以及後台管理功能。
    - **流程整合:** 結帳流程會強制要求使用者完善個人資料，確保訂單資訊的準確性。

- **`products` (商品系統):**
    - **核心模型:** `Product` 定義了「燈種」的屬性，如名稱、價格、圖片等。
    - **核心邏輯:** 提供了完整的商品後台管理功能，並有一個專門的前台頁面 (`product_offering_list`) 只顯示可供選購的商品。

- **`cart` (購物車系統):**
    - **核心模型:** `Cart` 和 `CartItem` 實現了標準的購物車功能。
    - **核心邏輯:** 支援將商品加入購物車、修改數量、計算總價，並引導使用者進入結帳流程。

- **`orders` (訂單系統):**
    - **核心模型:** `Order` 和 `OrderItem` 用於儲存訂單的歷史快照，包含當時的使用者資訊、商品、價格與數量。
    - **核心邏輯:** 結帳流程的最後一步。使用資料庫事務 (`transaction.atomic`) 確保在建立訂單、新增訂單項目及清空購物車過程中的資料一致性。

- **`pages` (靜態頁面):**
    - **核心邏輯:** 提供網站的首頁、關於我們等靜態內容頁面。

## 4. 核心業務流程

網站的主要使用者流程設計清晰，符合標準電子商務邏輯：

1.  **瀏覽商品:** 使用者在商品列表頁 (`/products/offerings/`) 瀏覽可點的燈種。
2.  **加入購物車:** 使用者選擇燈種和數量，並將其加入購物車。
3.  **結帳準備:** 使用者檢視購物車 (`/cart/`) 後，點擊「結帳」。
4.  **完善資料:** 系統會將使用者導向個人資料編輯頁 (`/my-account/profile/edit/`)，並透過 `next=payment` 參數要求使用者填寫或確認姓名、電話、地址等必要資訊。
5.  **訂單預覽與建立:** 資料完善後，使用者被導向付款頁面 (`/orders/payment/`)，此頁面會顯示最終的訂單預覽。確認後，系統會建立訂單 (`/orders/create/`)。
6.  **完成訂單:** 訂單建立成功後，購物車被清空，使用者看到訂單確認頁面。

## 5. 程式碼品質與實踐

- **優點:**
    - **結構清晰:** 專案遵循 Django App 的模組化設計，易於理解與擴充。
    - **命名規範:** 模型、視圖和 URL 的命名直觀且一致。
    - **善用 Django 功能:** 廣泛使用了 Django 的類別型視圖 (CBV)、Mixin、表單處理等功能。
    - **資料完整性:** 在訂單建立時使用資料庫事務，是確保資料一致性的良好實踐。
    - **業務邏輯封裝:** 將農曆轉換的邏輯封裝在 `CustomUser` 模型的 `save` 方法中，是合理的設計。

- **可改進之處:**
    - **註解與文件:** 部分程式碼缺乏註解，特別是複雜的業務邏輯或客製化部分，不利於長期維護。
    - **錯誤處理:** `create_order` 視圖中的 `try...except Exception` 範圍過於廣泛，應針對更具體的異常類型進行處理。
    - **日誌記錄:** 日誌記錄主要集中在訂單建立過程，可以在其他關鍵操作（如使用者註冊、登入失敗）中增加更多日誌。

## 6. 潛在風險與問題

- **安全性:**
    - **`DEBUG = True`:** 在生產環境中啟用 `DEBUG` 模式會洩漏大量敏感設定資訊，是**嚴重安全漏洞**。
    - **硬編碼 `SECRET_KEY`:** `SECRET_KEY` 直接寫在 `settings.py` 中，應立即改為從環境變數讀取。
    - **硬編碼資料庫憑證:** 資料庫的使用者名稱和密碼也是硬編碼，同樣應使用環境變數管理。
    - **`ALLOWED_HOSTS` 設定:** 目前的設定過於寬鬆，在生產環境中應限制為實際的域名。

- **維護性:**
    - **相依性檔案混亂:** `pyproject.toml` 和 `requirements.txt` 同時存在。`pyproject.toml` (配合 `uv.lock`) 應作為唯一的相依性來源，`requirements.txt` 應被移除或自動生成，以避免版本衝突和管理混亂。
    - **設定分離:** 缺乏開發、測試與生產環境的設定檔分離機制。所有環境共用一份 `settings.py` 會增加部署出錯的風險。
