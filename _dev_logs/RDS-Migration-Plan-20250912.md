# BESshow RDS 遷移計劃

## 1. 當前狀態分析

### 資料庫配置
- **引擎**：PostgreSQL 16
- **資料庫名稱**：besshow
- **用戶**：besshow
- **編碼**：UTF8
- **資料庫大小**：8.9 MB
- **表格數量**：18 個

### 主要表格
- accounts_customuser (用戶資料)
- products_product (產品資料)
- orders_order (訂單資料)
- cart_cart (購物車)
- django_* (系統表格)

## 2. AWS RDS 架構設計

### 建議配置
- **引擎**：PostgreSQL 16.x
- **實例類型**：db.t3.micro (測試) → db.t3.small (生產)
- **儲存**：20 GB gp3 (可擴展)
- **多可用區**：是 (生產環境)
- **備份保留**：7 天
- **維護視窗**：週日 03:00-04:00 UTC

### 安全配置
- **VPC**：使用 EC2 相同 VPC
- **子網群組**：私有子網
- **安全群組**：僅允許 EC2 存取 (端口 5432)
- **加密**：啟用靜態加密

## 3. 遷移策略

### 階段 1：準備階段
1. 建立 RDS 實例
2. 配置安全群組
3. 測試連線

### 階段 2：數據遷移
1. 建立資料庫備份
2. 匯入到 RDS
3. 驗證數據完整性

### 階段 3：應用程式切換
1. 更新 DATABASE_URL
2. 部署生產版本
3. 測試功能

### 階段 4：清理
1. 停止 Docker PostgreSQL 容器
2. 移除舊資料卷
3. 監控 RDS 效能

## 4. 成本估算 (ap-east-1)

### RDS 費用
- **db.t3.micro**：約 $0.024/小時 = $17.28/月
- **儲存 20GB**：約 $2.76/月
- **備份**：約 $0.10/月
- **總計**：約 $20/月

### 比較
- **Docker 容器**：$0 (使用 EC2 資源)
- **RDS**：$20/月
- **優勢**：自動備份、高可用性、管理便利

## 5. 風險評估

### 高風險
- 數據遷移過程中的資料遺失
- 應用程式停機時間

### 中風險
- 網路連線問題
- 效能差異

### 低風險
- 成本超支
- 配置錯誤

## 6. 回滾計劃

### 緊急回滾
1. 恢復 docker-compose.staging.yml
2. 重新啟動 PostgreSQL 容器
3. 從備份恢復數據

### 數據同步
- 保留 Docker 容器備份 7 天
- RDS 數據可匯出回 Docker

## 7. 監控與維護

### 監控指標
- CPU 使用率
- 記憶體使用率
- 連線數
- 查詢效能

### 維護任務
- 定期備份驗證
- 效能調優
- 安全更新

## 8. 實施時程

### 第 1 週：準備
- 建立 RDS 實例
- 配置網路與安全

### 第 2 週：測試
- 數據遷移測試
- 應用程式測試

### 第 3 週：正式遷移
- 生產環境遷移
- 監控與調優

## 9. 成功標準

- ✅ 零數據遺失
- ✅ 停機時間 < 30 分鐘
- ✅ 應用程式功能正常
- ✅ 效能無明顯下降
- ✅ 備份機制正常運作