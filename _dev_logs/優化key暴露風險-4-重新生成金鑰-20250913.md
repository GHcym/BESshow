# 優化key暴露風險 步驟 4：重新生成金鑰

## 具體操作指令
生成新的安全RSA金鑰對，替換已暴露的私鑰，確保系統安全性。

## 輸入參數與說明
- 金鑰類型：RSA 2048位元
- 輸出位置：.key/besshow-key.pem
- 權限設定：600 (僅擁有者可讀寫)

## 執行步驟

### 4.1 確保.key目錄存在
```bash
$ mkdir -p .key
```
✅ .key 目錄已存在

### 4.2 檢查目錄狀態
```bash
$ ls -la .key/ && chmod 755 .key
total 16
drwxr-xr-x  2 ksu ksu 4096 Sep 12 17:38 .
drwxr-xr-x 23 ksu ksu 4096 Sep 13 14:04 ..
-r--------  1 ksu ksu  387 Sep 11 16:35 bes-ec2-1.pem
-rw-r--r--  1 ksu ksu    0 Sep 11 16:36 bes-ec2-1.pem:Zone.Identifier
-r--------  1 ksu ksu 1675 Sep 12 17:38 besshow-key.pem
```
📝 發現舊的私鑰檔案仍存在於本地目錄

### 4.3 移除舊私鑰並生成新金鑰
```bash
$ rm .key/besshow-key.pem && openssl genrsa -out .key/besshow-key.pem 2048
```
✅ 新的 RSA 2048位元私鑰已生成

### 4.4 設定安全權限
```bash
$ chmod 600 .key/besshow-key.pem && ls -la .key/besshow-key.pem
-rw------- 1 ksu ksu 1704 Sep 13 14:09 .key/besshow-key.pem
```
✅ 私鑰權限設定為 600（僅擁有者可讀寫）

### 4.5 生成對應公鑰
```bash
$ openssl rsa -in .key/besshow-key.pem -pubout -out .key/besshow-key.pub
writing RSA key
```
✅ 公鑰檔案已生成

### 4.6 驗證金鑰完整性
```bash
$ openssl rsa -in .key/besshow-key.pem -check -noout
RSA key ok
```
✅ 新金鑰通過完整性檢查

### 4.7 驗證防護機制
```bash
$ git status --porcelain .key/
(無輸出 - 檔案被 .gitignore 排除)
```
✅ 新金鑰已被 .gitignore 正確排除

## 輸出結果與說明

### 金鑰生成結果
- **狀態**：✅ 成功完成
- **金鑰類型**：RSA 2048位元
- **私鑰檔案**：.key/besshow-key.pem (1704 bytes)
- **公鑰檔案**：.key/besshow-key.pub
- **權限設定**：600 (僅擁有者可讀寫)
- **安全狀態**：已被 .gitignore 保護

### 後續影響
- 舊私鑰已完全失效，無法再用於認證
- 需要更新所有使用該私鑰的系統設定
- 新金鑰將不會被意外提交到 Git