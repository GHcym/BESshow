# 優化key暴露風險 步驟 2：移除敏感檔案

## 具體操作指令
從 Git 歷史記錄中完全移除私鑰檔案，確保無法透過任何方式復原。

## 輸入參數與說明
- 目標檔案：`.key/besshow-key.pem`
- 移除方法：git filter-branch 或 BFG Repo-Cleaner
- 影響範圍：完整 Git 歷史

## 執行步驟

### 2.1 備份當前狀態
```bash
$ cp .key/besshow-key.pem /tmp/besshow-key-backup.pem
私鑰已備份到 /tmp/besshow-key-backup.pem
```
✅ 私鑰檔案已安全備份

### 2.2 從 Git 索引中移除檔案
```bash
$ git rm --cached .key/besshow-key.pem
rm '.key/besshow-key.pem'
```
✅ 檔案已從 Git 索引中移除

### 2.3 提交移除操作
```bash
$ git commit -m "Remove private key from tracking"
[main 1f61dcd] Remove private key from tracking
 1 file changed, 27 deletions(-)
 delete mode 100644 .key/besshow-key.pem
```
✅ 移除操作已提交

### 2.4 從 Git 歷史中完全移除
```bash
$ export FILTER_BRANCH_SQUELCH_WARNING=1 && git filter-branch --force --index-filter 'git rm --cached --ignore-unmatch .key/besshow-key.pem' --prune-empty --tag-name-filter cat -- --all
…處理 189 個提交記錄…
rm '.key/besshow-key.pem'
Ref 'refs/heads/main' was rewritten
Ref 'refs/remotes/origin/main' was rewritten
```
✅ 已從完整 Git 歷史中移除私鑰檔案

### 2.5 清理備份檔案
```bash
$ rm -rf .git/refs/original/ && git reflog expire --expire=now --all && git gc --prune=now --aggressive
```
✅ Git 倉庫已清理完成

### 2.6 驗證移除結果
```bash
$ git log --all --full-history -- .key/besshow-key.pem
(無輸出)
```
✅ 私鑰檔案已從 Git 歷史中完全消除

## 輸出結果與說明

### 移除結果
- **狀態**：✅ 成功完成
- **處理範圍**：189 個提交記錄
- **備份位置**：/tmp/besshow-key-backup.pem
- **安全狀態**：私鑰已從 Git 歷史中完全移除

### 後續影響
- Git 歷史已被重寫，需要強制推送到遠端倉庫
- 必須重新生成新的金鑰對
- 需要建立 .gitignore 防護機制