# 新增-信眾歷史訂單查詢 - 任務執行清單

**任務名稱：** 新增-信眾歷史訂單查詢  
**建立日期：** 2025-01-10  
**任務目標：** 為廟宇祈福網站新增信眾歷史訂單查詢功能，讓已登入用戶可以查看自己的點燈訂單記錄

## 執行步驟清單

### 階段一：分析現有架構
- [ ] **步驟 1.1** - 檢查現有 orders 模型結構
  - **操作指令：** 檢視 orders/models.py 檔案，了解訂單資料結構
  - **預期輸出：** 確認訂單模型欄位與用戶關聯方式
  - **必要輸入：** 無

- [ ] **步驟 1.2** - 檢查現有用戶認證系統
  - **操作指令：** 檢視 accounts 應用程式結構與認證流程
  - **預期輸出：** 確認用戶登入狀態檢查機制
  - **必要輸入：** 無

- [ ] **步驟 1.3** - 檢查現有 URL 路由結構
  - **操作指令：** 檢視主要 urls.py 與 orders/urls.py 檔案
  - **預期輸出：** 了解現有路由配置，規劃新路由位置
  - **必要輸入：** 無

### 階段二：實作後端功能
- [ ] **步驟 2.1** - 新增歷史訂單查詢視圖
  - **操作指令：** 在 orders/views.py 新增 order_history 視圖函數
  - **預期輸出：** 完成用戶訂單查詢邏輯，包含分頁與排序
  - **必要輸入：** 登入用戶驗證、訂單篩選邏輯

- [ ] **步驟 2.2** - 配置 URL 路由
  - **操作指令：** 在 orders/urls.py 新增歷史訂單查詢路由
  - **預期輸出：** 完成 /orders/history/ 路由配置
  - **必要輸入：** 視圖函數名稱

### 階段三：實作前端介面
- [ ] **步驟 3.1** - 建立歷史訂單模板
  - **操作指令：** 在 orders/templates/orders/ 建立 order_history.html
  - **預期輸出：** 完成訂單列表顯示頁面，包含訂單詳情與狀態
  - **必要輸入：** 訂單資料結構、Bootstrap 樣式

- [ ] **步驟 3.2** - 新增導航連結
  - **操作指令：** 在主導航或用戶選單新增「歷史訂單」連結
  - **預期輸出：** 用戶可從主頁面導航至歷史訂單頁面
  - **必要輸入：** 導航模板位置

### 階段四：測試與驗證
- [ ] **步驟 4.1** - 建立測試資料
  - **操作指令：** 建立測試用戶與訂單資料
  - **預期輸出：** 至少 3 筆不同狀態的測試訂單
  - **必要輸入：** Django 管理介面或資料庫操作

- [ ] **步驟 4.2** - 功能測試
  - **操作指令：** 測試登入用戶查詢歷史訂單功能
  - **預期輸出：** 確認功能正常運作，無錯誤訊息
  - **必要輸入：** 測試用戶帳號

- [ ] **步驟 4.3** - 權限測試
  - **操作指令：** 測試未登入用戶訪問限制
  - **預期輸出：** 未登入用戶被重導向至登入頁面
  - **必要輸入：** 無

## 當前狀態
- **執行位置：** 步驟 1.1
- **完成步驟：** 0/9
- **預估完成時間：** 2-3 小時

## 技術決策記錄
- 使用 Django 內建的 LoginRequiredMixin 進行權限控制
- 採用分頁顯示避免大量訂單影響效能
- 按訂單建立時間倒序排列（最新在前）