{% extends '_base.html' %}
{% load static %}

{% block title %}帳號列表維護{% endblock title %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-12">
            <!-- 頁面標題區域 -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h2 class="mb-1">
                        <i class="fas fa-users text-primary me-2"></i>帳號列表維護
                    </h2>
                    <p class="text-muted mb-0">管理系統使用者帳號</p>
                </div>
                <a href="{% url 'account_create' %}" class="btn btn-success">
                    <i class="fas fa-plus me-2"></i>新增帳號
                </a>
            </div>

            {% if accounts %}
                <!-- 搜尋區域 -->
                <div class="card shadow-sm mb-4">
                    <div class="card-body">
                        <div class="row align-items-center">
                            <div class="col-md-8">
                                <div class="input-group">
                                    <span class="input-group-text bg-light border-0">
                                        <i class="fas fa-search text-muted"></i>
                                    </span>
                                    <input type="text" class="form-control border-0 bg-light"
                                           placeholder="搜尋 Email、姓名或手機號碼..." id="userSearchInput">
                                </div>
                            </div>
                            <div class="col-md-4 text-end">
                                <small class="text-muted">共 {{ accounts|length }} 個帳號</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 帳號列表 -->
                {% for account in accounts %}
                <div class="card shadow-sm mb-3 border-0" data-account-row>
                    <div class="card-body">
                        <div class="row align-items-center">
                            <!-- 帳號頭像和基本資訊 -->
                            <div class="col-md-4 mb-3 mb-md-0">
                                <div class="d-flex align-items-center">
                                    <div class="bg-primary text-white rounded-circle d-flex align-items-center justify-content-center me-3"
                                         style="width: 50px; height: 50px;">
                                        <i class="fas fa-user fa-lg"></i>
                                    </div>
                                    <div>
                                        <h5 class="mb-1">{{ account.last_name }}{{ account.first_name }}</h5>
                                        <p class="text-muted mb-1">{{ account.email }}</p>
                                        <small class="text-muted">{{ account.username }}</small>
                                    </div>
                                </div>
                            </div>

                            <!-- 聯絡資訊 -->
                            <div class="col-md-3 mb-3 mb-md-0">
                                <div class="mb-2">
                                    <i class="fas fa-phone text-success me-2"></i>
                                    {% if account.phone_number %}
                                        {{ account.phone_number }}
                                    {% else %}
                                        <span class="text-muted">未設定</span>
                                    {% endif %}
                                </div>
                                <div>
                                    <i class="fas fa-venus-mars text-info me-2"></i>
                                    {{ account.get_gender_display }}
                                </div>
                            </div>

                            <!-- 狀態和權限 -->
                            <div class="col-md-3 mb-3 mb-md-0">
                                <div class="mb-2">
                                    {% if account.is_active %}
                                        <span class="badge bg-success">
                                            <i class="fas fa-check-circle me-1"></i>啟用中
                                        </span>
                                    {% else %}
                                        <span class="badge bg-secondary">
                                            <i class="fas fa-times-circle me-1"></i>已停用
                                        </span>
                                    {% endif %}
                                </div>
                                <div>
                                    {% if account.is_staff %}
                                        <span class="badge bg-warning text-dark">
                                            <i class="fas fa-crown me-1"></i>管理員
                                        </span>
                                    {% else %}
                                        <span class="badge bg-light text-dark">
                                            <i class="fas fa-user me-1"></i>一般用戶
                                        </span>
                                    {% endif %}
                                </div>
                            </div>

                            <!-- 操作按鈕 -->
                            <div class="col-md-2 text-end">
                                <a href="{% url 'account_update' account.pk %}" class="btn btn-primary btn-sm">
                                    <i class="fas fa-edit me-1"></i>編輯
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}

                <!-- 分頁 -->
                {% if is_paginated %}
                <nav aria-label="Page navigation" class="mt-4">
                    <ul class="pagination justify-content-center">
                        {% if page_obj.has_previous %}
                            <li class="page-item">
                                <a class="page-link" href="?page={{ page_obj.previous_page_number }}">
                                    <i class="fas fa-chevron-left"></i>
                                </a>
                            </li>
                        {% endif %}

                        {% for num in page_obj.paginator.page_range %}
                            {% if page_obj.number == num %}
                                <li class="page-item active">
                                    <a class="page-link" href="?page={{ num }}">{{ num }}</a>
                                </li>
                            {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                                <li class="page-item">
                                    <a class="page-link" href="?page={{ num }}">{{ num }}</a>
                                </li>
                            {% endif %}
                        {% endfor %}

                        {% if page_obj.has_next %}
                            <li class="page-item">
                                <a class="page-link" href="?page={{ page_obj.next_page_number }}">
                                    <i class="fas fa-chevron-right"></i>
                                </a>
                            </li>
                        {% endif %}
                    </ul>
                </nav>
                {% endif %}

            {% else %}
                <!-- 空狀態 -->
                <div class="card shadow-sm border-0">
                    <div class="card-body text-center py-5">
                        <div class="mb-4">
                            <i class="fas fa-users fa-4x text-muted"></i>
                        </div>
                        <h4 class="text-muted mb-3">目前沒有任何帳號</h4>
                        <p class="text-muted mb-4">開始建立第一個帳號，讓系統開始運作吧！</p>
                        <a href="{% url 'account_create' %}" class="btn btn-primary btn-lg">
                            <i class="fas fa-plus me-2"></i>建立第一個帳號
                        </a>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<style>
.card {
    border-radius: 10px;
    overflow: hidden;
}

.card-body {
    padding: 1.5rem;
}

.pagination .page-link {
    border-radius: 0.375rem !important;
    margin: 0 2px;
    border: 1px solid #dee2e6;
}

.pagination .page-item.active .page-link {
    background-color: #007bff;
    border-color: #007bff;
}

.btn:hover {
    transform: translateY(-1px);
    transition: all 0.2s ease;
}

@media (max-width: 768px) {
    .d-flex.justify-content-between.align-items-center.mb-4 {
        flex-direction: column;
        align-items: flex-start !important;
        gap: 1rem;
    }

    .btn {
        width: 100%;
    }
}
</style>

{% block javascript %}
{{ block.super }}
<script>
// 搜尋功能
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('userSearchInput');
    if (searchInput) {
        const accountRows = document.querySelectorAll('[data-account-row]');

        searchInput.addEventListener('input', function() {
            const filter = this.value.toLowerCase().trim();

            accountRows.forEach(row => {
                const text = row.textContent.toLowerCase();
                if (text.includes(filter) || filter === '') {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        });
    }
});
</script>
{% endblock javascript %}

{% endblock content %}